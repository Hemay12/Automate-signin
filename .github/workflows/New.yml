name: Run TestNG Tests

on: 
  push:
    branches:
      - main
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Build and Run Tests
        run: mvn test

      - name: Upload Test Reports
        if: always()  # Ensures reports are uploaded even if tests fail
        uses: actions/upload-artifact@v4
        with:
          name: Test-Reports
          path: target/surefire-reports

        
    # Send Email on Failure
      - name: Send Email Notification
        if: failure() # Triggers only if the workflow fails
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USER }}  # âœ… Use Secret
          password: ${{ secrets.EMAIL_PASS }} 
          subject: "GitHub Actions Test Failed ðŸš¨"
          to: "hemaysorathia1@gmail.com"
          body: "The automation test failed. Please check the logs and test reports in GitHub Actions."
          from: "GitHub Actions"

